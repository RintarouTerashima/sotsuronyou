# バーコードスキャン WTP調査アプリ

## プロジェクト概要

iPhone/iPadのカメラでバーコード（JANコード）を読み取り、商品情報を表示して支払意思額（WTP: Willingness To Pay）を記録する静的Webアプリケーション。GitHub Pagesでのデプロイに対応。

**作成日**: 2025年10月9日

## 現在の状態

✅ **完成・動作確認済み**

すべての主要機能が実装され、動作しています：
- カメラによるバーコードスキャン機能
- **複数商品の連続スキャン機能（NEW!）**
- 商品データベースからの商品情報表示
- 商品画像の自動表示
- 合計WTP入力・記録機能
- CSVダウンロード機能
- ローカルストレージでのデータ永続化
- モバイルフレンドリーなUI

## 最近の変更

### 2025-11-06: 操作フローの変更
- **操作フローを変更**: 個別商品ごとのWTP入力から、複数商品スキャン後の合計WTP入力へ
- スキャンした商品のリアルタイム表示機能を追加
- 「スキャン終了」ボタンを追加（複数商品スキャン完了時に使用）
- デバウンス処理を実装（2秒間のクールダウンで重複スキャンを防止）
- CSV出力形式を複数商品対応に変更（商品数、バーコード、商品名をパイプ区切りで記録）
- キャンセル機能を追加
- 既存機能（スキャン開始/停止、CSVダウンロード、データクリア）は維持

### 2025-10-09: 商品画像表示機能追加
- 商品データベースを拡張（name/imageプロパティ追加）
- HTMLに画像表示要素を追加
- スキャン時に商品画像を自動表示
- プレースホルダー画像対応（未登録商品用）
- モバイル最適化された画像スタイリング

### 2025-10-09: プロジェクト初期作成
- HTML構造の実装（index.html）
- モバイル最適化されたCSSスタイリング（style.css）
- バーコードスキャン機能の実装（app.js + html5-qrcode.js）
- 商品データベース実装（4商品登録）
- CSV記録・ダウンロード機能実装
- ローカルストレージ対応
- GitHub Pages対応ドキュメント作成

## ユーザー設定・要件

### 技術要件
- **フロントエンドのみ**: HTML + CSS + JavaScript（バックエンドなし）
- **ライブラリ**: html5-qrcode.js（CDN経由）
- **対応環境**: Safari/iOS（iPhone・iPad）
- **デプロイ先**: GitHub Pages対応の静的サイト
- **HTTPS必須**: カメラアクセスのため

### 機能要件
1. バーコード（JANコード）の連続スキャン
2. 商品名の自動表示（事前登録リストから）
3. 複数商品の合計支払意思額（WTP）入力フォーム
4. データのCSV形式記録（タイムスタンプ、商品数、バーコード、商品名、WTP）
5. CSVダウンロード機能
6. モバイルフレンドリーなUI
7. デバウンス機能（重複スキャン防止）

### 商品データベース
```javascript
{
  "4901777018686": {
    name: "ポカリスエット 500ml",
    image: "https://via.placeholder.com/300x300/4A90E2/ffffff?text=ポカリスエット"
  },
  "4901777337398": {
    name: "イオン天然水 2L",
    image: "https://via.placeholder.com/300x300/50C878/ffffff?text=天然水"
  },
  "4901777277397": {
    name: "おにぎり（鮭）",
    image: "https://via.placeholder.com/300x300/FFB347/ffffff?text=おにぎり"
  },
  "4901777017770": {
    name: "チョコレートバー",
    image: "https://via.placeholder.com/300x300/8B4513/ffffff?text=チョコレート"
  }
}
```

**注意**: 現在はプレースホルダー画像を使用しています。実際の商品画像URLに置き換えることができます。

## プロジェクト構成

```
/
├── index.html          # メインHTMLファイル
├── style.css           # スタイルシート（モバイル最適化）
├── app.js              # JavaScript（バーコードスキャン・データ管理）
├── README.md           # プロジェクトドキュメント
├── .gitignore          # Git除外設定
└── replit.md           # プロジェクトメモリ（このファイル）
```

## アーキテクチャの重要な決定

### 2025-10-09: 技術選定
- **html5-qrcode.js**: バーコードスキャンライブラリとして選定
  - 理由: iOS Safari対応、JANコード対応、CDN経由で使用可能
  - バージョン: 2.3.8
  
- **ローカルストレージ**: データ永続化方法
  - 理由: バックエンド不要、シンプル実装、GitHub Pages対応
  - 注意: ブラウザキャッシュクリアでデータ消失のため定期的CSVダウンロード推奨

- **Python http.server**: 開発用サーバー
  - 理由: シンプル、HTTPS環境用、静的ファイル配信

### UIデザイン決定
- グラデーション背景（紫系）でモダンな見た目
- 大きなボタンとタップ可能領域（モバイル最適化）
- 絵文字アイコンでビジュアル認識性向上
- レスポンシブデザイン（400px、600px、800pxブレークポイント）

## デプロイメント

### ローカル開発
```bash
python -m http.server 5000
```
→ https://localhost:5000 でアクセス

### GitHub Pagesデプロイ
1. リポジトリのSettings > Pages
2. Source: "Deploy from a branch"
3. Branch: "main" + "/ (root)"
4. Save → 数分後にURL発行

## 使用方法

1. 「📷 スキャン開始」をタップ
2. カメラ許可を承認
3. 複数の商品バーコードを連続してスキャン（スキャンした商品が一覧表示されます）
4. 「✅ スキャン終了」をタップ
5. 全商品の合計支払意思額を入力
6. 「✅ 送信」で記録
7. 「💾 CSVダウンロード」でデータ保存

**注意**: 同じ商品を2秒以内に再度スキャンしても無視されます（重複防止機能）

## データ形式

### CSV出力形式
```
タイムスタンプ,商品数,バーコード番号,商品名,WTP金額
"2025/11/06 13:30:45",3,"4903301318620|4901777337398|4901777277397","ポカリスエット 500ml|イオン天然水 2L|おにぎり（鮭）",500
```
複数商品の場合、バーコード番号と商品名はパイプ（|）区切りで記録されます。

### ローカルストレージ形式（JSON）
```json
[
  {
    "timestamp": "2025/11/06 13:30:45",
    "barcode": "4903301318620|4901777337398|4901777277397",
    "productName": "ポカリスエット 500ml|イオン天然水 2L|おにぎり（鮭）",
    "itemCount": 3,
    "wtp": 500
  }
]
```
複数商品の場合、barcodeとproductNameはパイプ（|）区切りで保存されます。

## トラブルシューティング

### カメラが起動しない
- HTTPS環境か確認
- ブラウザのカメラ許可を確認
- iOSの設定 > Safari > カメラ を確認

### データが消えた
- ブラウザキャッシュクリア/プライベートモードが原因
- 定期的にCSVダウンロード推奨

### バーコードが読み取れない
- 照明を明るくする
- バーコードをカメラに近づける
- 対応形式: EAN-13, EAN-8, CODE-128, CODE-39, UPC-A, UPC-E

## 今後の拡張案

- 商品データの外部JSON/CSVファイルからの読み込み
- 画像アップロード機能
- データ編集・削除機能
- グラフ・統計表示
- オフライン対応強化
- PWA化

## 言語

プロジェクトは日本語で構築されています（UI、コメント、ドキュメント）。
